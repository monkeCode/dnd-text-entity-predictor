schema: '2.0'
stages:
  dowload_pages:
    cmd: python download_site.py --output data/pages.csv --workers 5
    deps:
    - path: download_site.py
      hash: md5
      md5: 7c167d78c162a4f07363302c0f3f2f9a
      size: 3899
    outs:
    - path: data/pages.csv
      hash: md5
      md5: c615256c67d7606d0ed86d81d3d46bd9
      size: 636746478
  make_annotations:
    cmd: python annotate_texts.py
    deps:
    - path: annotate_texts.py
      hash: md5
      md5: cfb5038e26517a09d8524d8bb293f7a7
      size: 7838
    - path: data/pages.csv
      hash: md5
      md5: c615256c67d7606d0ed86d81d3d46bd9
      size: 636746478
    - path: data/pathfinder_json.csv
      hash: md5
      md5: 7ce4a4635e29a387f4e5d5dbacee111e
      size: 23675060
    outs:
    - path: data/annotations.csv
      hash: md5
      md5: ef7dbfcca0072b2612b10f1fcce67351
      size: 1483375
    - path: data/texts.csv
      hash: md5
      md5: 19b3116e84fca9dc22a959d3fdbdef9e
      size: 40829183
  make_datasets:
    cmd: python create_datasets.py --texts data/texts.csv --annotations data/annotations.csv
    deps:
    - path: create_datasets.py
      hash: md5
      md5: 678dbee8a1409d7a77f0ac0aa56ec301
      size: 4963
    - path: data/annotations.csv
      hash: md5
      md5: ef7dbfcca0072b2612b10f1fcce67351
      size: 1483375
    - path: data/synt_annotations.csv
      hash: md5
      md5: 3c487da7ed2970776886eb9ee31d7d4a
      size: 2120623
    - path: data/synt_texts.csv
      hash: md5
      md5: b9075d2cd6023e7f0e63127d94183415
      size: 16750144
    - path: data/texts.csv
      hash: md5
      md5: 19b3116e84fca9dc22a959d3fdbdef9e
      size: 40829183
    - path: ner_dataset.py
      hash: md5
      md5: ff6c0e629f415d3efb145b76b9b76348
      size: 3807
    params:
      params.yaml:
        base-model: DeepPavlov/bert-base-bg-cs-pl-ru-cased
        binary-mode: true
        lower_texts: true
        max-tokens: 200
        use_syntetic_data: true
    outs:
    - path: data/ner_dataset
      hash: md5
      md5: aaed35f638aa8ebf77cfe4a051da1d52.dir
      size: 128926710
      nfiles: 5
  pathfinder_downloader:
    cmd: python ./download_pathfinder.py --output data/pathfinder_json.csv --delay
      3
    deps:
    - path: download_pathfinder.py
      hash: md5
      md5: dbbf73c186ee68adc79cee239d586c5d
      size: 3676
    outs:
    - path: data/pathfinder_json.csv
      hash: md5
      md5: 7ce4a4635e29a387f4e5d5dbacee111e
      size: 23675060
  train:
    cmd: python train_model.py
    deps:
    - path: data/ner_dataset/labels.txt
      hash: md5
      md5: a2254097aba1c5e55040163327689913
      size: 20
    - path: data/ner_dataset/test_dataset.pt
      hash: md5
      md5: 4c0e11095d5a381c2b3807a8b6195fa8
      size: 10911819
    - path: data/ner_dataset/train_dataset.pt
      hash: md5
      md5: 22aa672100dc87329bdc68beb65ec059
      size: 106524497
    - path: data/ner_dataset/val_dataset.pt
      hash: md5
      md5: c436ff3983408d4d5c9d68cfc6e6f31f
      size: 10786629
    - path: train_model.py
      hash: md5
      md5: 00bebbfa7d2a741f82a09d4d2db0b405
      size: 4628
    params:
      params.yaml:
        base-model: DeepPavlov/bert-base-bg-cs-pl-ru-cased
        train:
          epoches: 70
          lr: 1e-05
          early_stopping_patience: 5
          batch-size: 64
          num-workers: 5
          freeze: true
          dropout_rate: 0.1
          use_prev_label: false
          weights:
          - 1
          - 1
          - 1
    outs:
    - path: models
      hash: md5
      md5: fc01463913e3fc5f2c9b964ec5348329.dir
      size: 710172739
      nfiles: 1
  prepare_syntetic_data:
    cmd: python prepare_syntetic_data.py --input_files data/ya_generated.csv data/lmstudio_responses.csv
      --output_texts data/synt_texts.csv --output_annotations data/synt_annotations.csv
    deps:
    - path: data/lmstudio_responses.csv
      hash: md5
      md5: 19e7ffbef57f7fca210052bc8c5fb9a0
      size: 1971795
    - path: data/ya_generated.csv
      hash: md5
      md5: 4a8fd0cc635e8012d8d180bf9ab3fe18
      size: 49928485
    - path: prepare_syntetic_data.py
      hash: md5
      md5: 8327847565010be01e1e38dd355b974b
      size: 7073
    outs:
    - path: data/synt_annotations.csv
      hash: md5
      md5: 3c487da7ed2970776886eb9ee31d7d4a
      size: 2120623
    - path: data/synt_texts.csv
      hash: md5
      md5: b9075d2cd6023e7f0e63127d94183415
      size: 16750144
