schema: '2.0'
stages:
  dowload_pages:
    cmd: python download_site.py --output data/pages.csv --workers 5
    deps:
    - path: download_site.py
      hash: md5
      md5: 58e89d55e37d26caddabb80ceed988a2
      size: 3675
    outs:
    - path: data/pages.csv
      hash: md5
      md5: dc499e86e25721e51ad354e18845b9c7
      size: 422942892
  make_annotations:
    cmd: python annotate_texts.py
    deps:
    - path: annotate_texts.py
      hash: md5
      md5: cfb5038e26517a09d8524d8bb293f7a7
      size: 7838
    - path: data/pages.csv
      hash: md5
      md5: dc499e86e25721e51ad354e18845b9c7
      size: 422942892
    - path: data/pathfinder_json.csv
      hash: md5
      md5: 7ce4a4635e29a387f4e5d5dbacee111e
      size: 23675060
    outs:
    - path: data/annotations.csv
      hash: md5
      md5: e2bc2d011481e26fb369de37543ca6e1
      size: 1434837
    - path: data/texts.csv
      hash: md5
      md5: a00b2aa8e28576c5a879448c4ec34012
      size: 36202236
  make_datasets:
    cmd: python create_datasets.py --texts data/texts.csv --annotations data/annotations.csv
    deps:
    - path: create_datasets.py
      hash: md5
      md5: b9ec96927509fd8ac6a450b645d23629
      size: 4147
    - path: data/annotations.csv
      hash: md5
      md5: e2bc2d011481e26fb369de37543ca6e1
      size: 1434837
    - path: data/texts.csv
      hash: md5
      md5: a00b2aa8e28576c5a879448c4ec34012
      size: 36202236
    - path: ner_dataset.py
      hash: md5
      md5: ff6c0e629f415d3efb145b76b9b76348
      size: 3807
    params:
      params.yaml:
        base-model: cointegrated/rubert-tiny2
        max-tokens: 200
    outs:
    - path: data/ner_dataset
      hash: md5
      md5: 79b7dd5cda63b0ff8fbc6699c3afcf2b.dir
      size: 71790032
      nfiles: 5
  pathfinder_downloader:
    cmd: python ./download_pathfinder.py --output data/pathfinder_json.csv --delay
      3
    deps:
    - path: download_pathfinder.py
      hash: md5
      md5: dbbf73c186ee68adc79cee239d586c5d
      size: 3676
    outs:
    - path: data/pathfinder_json.csv
      hash: md5
      md5: 7ce4a4635e29a387f4e5d5dbacee111e
      size: 23675060
  train:
    cmd: python train_model.py
    deps:
    - path: data/ner_dataset/labels.txt
      hash: md5
      md5: 3569504ffcfd1ff47ea6011f904f0e8c
      size: 52
    - path: data/ner_dataset/test_dataset.pt
      hash: md5
      md5: 1eba2308e4fdb01f85cb4b0272414734
      size: 9378827
    - path: data/ner_dataset/train_dataset.pt
      hash: md5
      md5: 50a7bde7341c9647363eb0d402084fc3
      size: 52507857
    - path: data/ner_dataset/val_dataset.pt
      hash: md5
      md5: a6a2743ba977c19f26cf85f040e1fb4c
      size: 9284101
    - path: train_model.py
      hash: md5
      md5: 7d7ee9f217d27bb42bb26355bd556103
      size: 3551
    params:
      params.yaml:
        base-model: cointegrated/rubert-tiny2
        train:
          epoches: 50
          lr: 1e-05
          batch-size: 64
          num-workers: 5
          freeze: false
          dropout_rate: 0.1
          use_prev_label: false
    outs:
    - path: models
      hash: md5
      md5: a48d4b77919e66298ece8871a3588629.dir
      size: 116999748
      nfiles: 1
