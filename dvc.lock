schema: '2.0'
stages:
  dowload_pages:
    cmd: python download_site.py --output data/pages.csv --workers 5
    deps:
    - path: download_site.py
      hash: md5
      md5: 7c167d78c162a4f07363302c0f3f2f9a
      size: 3899
    outs:
    - path: data/pages.csv
      hash: md5
      md5: c615256c67d7606d0ed86d81d3d46bd9
      size: 636746478
  make_annotations:
    cmd: python annotate_texts.py
    deps:
    - path: annotate_texts.py
      hash: md5
      md5: cfb5038e26517a09d8524d8bb293f7a7
      size: 7838
    - path: data/pages.csv
      hash: md5
      md5: c615256c67d7606d0ed86d81d3d46bd9
      size: 636746478
    - path: data/pathfinder_json.csv
      hash: md5
      md5: 7ce4a4635e29a387f4e5d5dbacee111e
      size: 23675060
    outs:
    - path: data/annotations.csv
      hash: md5
      md5: ef7dbfcca0072b2612b10f1fcce67351
      size: 1483375
    - path: data/texts.csv
      hash: md5
      md5: 19b3116e84fca9dc22a959d3fdbdef9e
      size: 40829183
  make_datasets:
    cmd: python create_datasets.py --texts data/texts.csv --annotations data/annotations.csv
    deps:
    - path: create_datasets.py
      hash: md5
      md5: 04ee138ba866674b6b70c7fd4a62bb02
      size: 4667
    - path: data/annotations.csv
      hash: md5
      md5: ef7dbfcca0072b2612b10f1fcce67351
      size: 1483375
    - path: data/synt_annotations.csv
      hash: md5
      md5: d2e115c9061cc9d04836c20ae49ac485
      size: 2143655
    - path: data/synt_texts.csv
      hash: md5
      md5: d271b2f5672faa5960e3bdbf8d78f979
      size: 17300259
    - path: data/texts.csv
      hash: md5
      md5: 19b3116e84fca9dc22a959d3fdbdef9e
      size: 40829183
    - path: ner_dataset.py
      hash: md5
      md5: ff6c0e629f415d3efb145b76b9b76348
      size: 3807
    params:
      params.yaml:
        base-model: cointegrated/rubert-tiny2
        lower_texts: true
        max-tokens: 200
        use_syntetic_data: true
    outs:
    - path: data/ner_dataset
      hash: md5
      md5: 20499558f3ea572358613744a8b74f93.dir
      size: 121426710
      nfiles: 5
  pathfinder_downloader:
    cmd: python ./download_pathfinder.py --output data/pathfinder_json.csv --delay
      3
    deps:
    - path: download_pathfinder.py
      hash: md5
      md5: dbbf73c186ee68adc79cee239d586c5d
      size: 3676
    outs:
    - path: data/pathfinder_json.csv
      hash: md5
      md5: 7ce4a4635e29a387f4e5d5dbacee111e
      size: 23675060
  train:
    cmd: python train_model.py
    deps:
    - path: data/ner_dataset/labels.txt
      hash: md5
      md5: 3569504ffcfd1ff47ea6011f904f0e8c
      size: 52
    - path: data/ner_dataset/test_dataset.pt
      hash: md5
      md5: 5b0787ac467a013ed80d084d06c4f73b
      size: 10162571
    - path: data/ner_dataset/train_dataset.pt
      hash: md5
      md5: 6440bef675b918f2fc031f98a9f54621
      size: 58891921
    - path: data/ner_dataset/val_dataset.pt
      hash: md5
      md5: e1de560f57be59f659b9e4bb5f4bc3fd
      size: 10055749
    - path: train_model.py
      hash: md5
      md5: 6338fede7da3f55d5ac5998d201ce647
      size: 3681
    params:
      params.yaml:
        base-model: cointegrated/rubert-tiny2
        train:
          epoches: 50
          lr: 1e-05
          batch-size: 64
          num-workers: 5
          freeze: false
          dropout_rate: 0.1
          use_prev_label: true
          weights:
          - 1
          - 2
          - 2
          - 3
          - 2.5
          - 3
          - 2.5
    outs:
    - path: models
      hash: md5
      md5: cb5ec43815174180833e93a310a63647.dir
      size: 117034609
      nfiles: 1
  prepare_syntetic_data:
    cmd: python prepare_syntetic_data.py --input_files data/ya_generated.csv data/lmstudio_responses.csv
      --output_texts data/synt_texts.csv --output_annotations data/synt_annotations.csv
    deps:
    - path: data/lmstudio_responses.csv
      hash: md5
      md5: 97d028b68d0fe64555861785e98cfb9f
      size: 1971794
    - path: data/ya_generated.csv
      hash: md5
      md5: 40353700b57bd79959956bc5573f7d14
      size: 49928484
    - path: prepare_syntetic_data.py
      hash: md5
      md5: d3ef62124b98fcd1cefa00298c1d2e14
      size: 6849
    outs:
    - path: data/synt_annotations.csv
      hash: md5
      md5: d2e115c9061cc9d04836c20ae49ac485
      size: 2143655
    - path: data/synt_texts.csv
      hash: md5
      md5: d271b2f5672faa5960e3bdbf8d78f979
      size: 17300259
